name: ğŸŒ™ Mise Ã  jour complÃ¨te du profil

on:
    schedule:
        # Tous les dimanches Ã  3h UTC
        - cron: "0 3 * * 0"
    workflow_dispatch: # Permet de dÃ©clencher manuellement

jobs:
    update-complete:
        runs-on: ubuntu-latest
        permissions:
            contents: write

        steps:
            - name: ğŸ“¥ Checkout repository
              uses: actions/checkout@v4
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}

            - name: ğŸ Setup Python
              uses: actions/setup-python@v5
              with:
                  python-version: "3.11"

            - name: ğŸ“¦ Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install -r requirements.txt

            - name: ğŸ” DÃ©couvrir les projets
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                  python update-profile.py --export config/projects-data.json

            - name: ğŸ“ Mettre Ã  jour le README
              run: |
                  python auto-update-readme.py

            - name: ğŸ” Auditer les projets
              run: |
                  python scripts/audit-projects.py --output audits/AUDIT-COMPLET-PROJETS.md
              continue-on-error: true

            - name: ğŸ“Š Mettre Ã  jour les mÃ©triques
              run: |
                  python scripts/update_readme_metrics.py
              continue-on-error: true

            - name: ğŸ·ï¸ CrÃ©er les badges
              run: |
                  python scripts/create_badges_metrics.py
              continue-on-error: true

            - name: ğŸ“¤ Commit et push
              if: github.event_name != 'pull_request'
              run: |
                  git config user.name "github-actions[bot]"
                  git config user.email "github-actions[bot]@users.noreply.github.com"
                  git add config/projects-data.json README.md audits/AUDIT-COMPLET-PROJETS.md metrics/ scripts/*.json 2>/dev/null || true
                  git diff --staged --quiet || git commit -m "ğŸŒ™ Mise Ã  jour complÃ¨te automatique [skip ci]"
                  git push || echo "No changes to commit"
